var Color=function(t){function e(t){return(+t).toExponential().split("e")}function r(t,e){return+(+t+"e"+ +e)}function a(t){if(!isFinite(t))return 0;var r=e(t);return+r[1]+(1===r[0].length?0:2-r[0].length)}function n(t,a){var n=e(t),o=Math.round(r(n[0],n[1]-a)),i=e(o);return r(i[0],+i[1]+a)}function o(t,e,r){var a=Math.sqrt(Math.pow(e,2)-4*t*r);return[(-e+a)/(2*t),(-e-a)/(2*t)]}function i(t,e,r,o){var i=Math.max(e,r),s=Math.min(e,r),h=Math.abs(isFinite(o)?o:0);return s>t?s:t>i?i:0!==h?n(Math.round((t-s)/h)*h+s,Math.min(a(h),a(s))):+t}function s(t,e,r){return(t-r)/(e-r)}function h(t,e,r){return t*(e-r)+ +r}function l(t,e,r,a){return i(h(t,e,r),e,r,a)}function p(t,e,r,a){return isFinite(t)&&t>=r&&e>=t&&(0===a||t===i(t,e,r,a))}function u(t,e){for(var r,a=!0,n=t.scales,o=0;o<n.keys.length;o++)r=n[n.keys[o]],a=a&&p(t[o],r.max,r.min,"number"==typeof e?e:r.step);return r=n.alpha,a&&p(t.alphaValue,r.max,r.min,"number"==typeof e?e:r.step)}function m(t,e){this[t]=+e}function c(t,e){return new T(this,e,+this[t])}function y(e,r){return t.modes[r].keys.forEach(function(t){delete e[t]}),e}function d(e,r){var a=t.modes[r],n=a.keys;return n.forEach(function(t,r){Object.defineProperty(e,t,{configurable:!0,enmuberable:!0,set:m.bind(e,r),get:c.bind(e,r,t)})}),e}function f(e,r){var a=e.length,n=t.modes[r],o=n.keys.length-a;if(o<0)for(var i=0;-o>i;i++)Array.prototype.pop.call(e);else for(var i=0;o>i;i++)Array.prototype.push.call(e,n[n.keys[a+i]].min);return e}function x(t,e,r){return e!==r&&(f(t,r),void 0!==e&&y(t,e),d(t,r)),t}function _(t){for(var e=Array(t.length),r=0;r<t.length;r++)e[r]=t[r];return e}function M(t){for(var e=[],r=0;r<t.length;r++)if(t[r]instanceof Array)for(var a=0;a<t[r].length;a++)e.push(t[r][a]);else e.push(t[r]);return e}function w(e){for(var r,a={string:[],number:[],object:[],"function":[],"boolean":[],undefined:[],color:[]},n=0;n<e.length;n++)if(e[n]instanceof t)a.color.push(e[n]);else if(e[n]instanceof Array)for(var o=0;o<e[n].length;o++)r=e[n][o],a[typeof r].push(r);else r=e[n],a[typeof r].push(r);return a}function z(e,r){var a=t.converters,n=[e],o={};o[e]=!0;t:for(;n[n.length-1]!==r&&0!==n.length;){var i=a[n[n.length-1]]||{},s=Object.keys(i);if(i.hasOwnProperty(r)){n.push(r);break}for(var h in s)if(!o.hasOwnProperty(s[h])&&a[s[h]]&&!a[s[h]].path_exclude){n.push(s[h]),o[s[h]]=!0;continue t}n.pop()}return n}function k(e,r){var a,n,o=z(e,r),i=[];o.length>1&&"ratio"===t.converters[o[0]][o[1]].from.type&&i.push(t.converters.array.ratio.fn.bind(null,o[0]));for(var s=1;s<o.length;s++)a=t.converters[o[s-1]][o[s]],n=t.converters[o[s]][o[s+1]]||null,i.push(a.fn),null===n?"ratio"===a.to.type&&i.push(t.converters.ratio.array.fn.bind(null,o[s])):"ratio"===a.to.type&&"array"===n.from.type?i.push(t.converters.ratio.array.fn.bind(null,o[s])):"array"===a.to.type&&"ratio"===n.from.type&&i.push(t.converters.array.ratio.fn.bind(null,o[s]));return i}function P(){var e=t.converters;Object.keys(e).forEach(function(r){Object.keys(e[r]).forEach(function(a){!t.prototype.hasOwnProperty(a)&&t.modes.hasOwnProperty(r)&&(t.prototype[a]=function(t){return this.duplicate().to(a,t)},e[a]&&!e[a].path_exclude&&(t.prototype["to_"+a]=function(t){return this.to(a,t)}))})})}function O(){var e=t.converters,r={},a={};return Object.keys(e).forEach(function(t){r[t]=1,Object.keys(e[t]).forEach(function(t){"path_exclude"!==t&&(r[t]=1)})}),Object.keys(r).forEach(function(t){a[t]={},Object.keys(r).forEach(function(e){a[t][e]=k(t,e)})}),t.converters.matrix=a}function A(t,e){try{for(var r=0;r<e.length;r++)t=e[r](t);return t}catch(a){return null}}function j(e,r,a){if(e.mode!==r){var n=A(e.arrayWithAlpha,t.converters.matrix[e.mode][r]);if(!Array.isArray(n))return n;e.mode=r,e.array=n}switch(typeof a){case"undefined":e.truncate();break;case"string":case"number":isFinite(a)&&e.truncate(+a);break;case"boolean":a&&e.truncate()}return e}function I(e){for(var r in t.parsers){var a=t.parsers[r](e);if(a instanceof t)return a}return null}function F(){for(var e,r,a=Object.keys(t.modes),n=0;n<a.length;n++){e=t.modes[a[n]],e.length=e.keys.length+1;for(var o=0;o<e.length;o++)r=e[e.keys[o]]||e.alpha,r.range=r.max-r.min,r.loop||(r.loop=!1)}}function W(e){if(e.toString){for(var r=(""+e).toLowerCase().replace(/[\(\[]/,",").replace(/[\)\]];?\s*$/,"").trim().split(/(?:,\s*|\s+)/),a=[],n=0;n<r.length;n++)isFinite(r[n])&&""!==r[n]?a.push(+r[n]):t.modes.hasOwnProperty(r[n])&&!t.modes[r[n]].path_exclude?a.push(r[n]):r[n].match(/a$/)&&t.modes.hasOwnProperty(tmp=r[n].substr(0,r[n].length-1))&&!t.modes[tmp].path_exclude&&a.push(tmp);if(a.length>1)return t.apply(null,a);if(a.length>0&&isFinite(a[0]))return t.apply(null,["grayscale",a[0]])}return null}function E(t,e,r,a,n,o){var i=t.mode;t.to(o,!1);var s=t[e],l=s.scale;return t[e]=n?"loop"===r?(s.value*(a+1)+l.max-l.min)%(l.max-l.min):s.value*(a+1):"ratio"===r?s.value+h(a,l.max,l.min):"loop"===r?(s.value+a+l.max-l.min)%(l.max-l.min):s.value+a,t.truncate(0),t.to(i,!1),t.truncate(0),t}function R(t,e,r,a,n,o,i){var s;if(i=e.hasOwnProperty(i)?i:e.hasOwnProperty(n.mode)?n.mode:r,"string"==typeof o&&(s=o.match(/^(-?\d*?\.?\d+)%$/)))o=+s[1]/100;else{if(!isFinite(o))return n;o=+o}return"ratio"!==a||1>o&&o>-1||(o/=100),e.hasOwnProperty(i)?E(n,e[i],a,o,s,i):null}function q(){Object.keys(t.adjusters).forEach(function(e){var r=t.adjusters[e];t.prototype[e]=function(t,a){return R(e,r.available_modes,r.default_mode,r.type,this,t,a)}})}function V(t,e,r,a,n,o){var i=Array(e);o=r.hasOwnProperty(o)?o:r.hasOwnProperty(n.mode)?n.mode:a;for(var s=0;e>s;s++)i[s]=n.duplicate();return r.hasOwnProperty(o)?r[o](i,o):null}function L(t,e){return t[0].hue(360,e),t[1].hue(120,e),t[2].hue(240,e),t}function $(t,e){return t[0].hue(-30,e),t[1].hue(360,e),t[2].hue(30,e),t}function S(t,e){return t[0].hue(360,e),t[1].hue(180,e),t}function C(t,e){return t[0].lightness(0,e),t[1].lightness("-10%",e),t[2].lightness("-30%",e),t[3].lightness("-70%",e),t}function D(){Object.keys(t.series).forEach(function(e){var r=t.series[e];t.prototype[e]=function(t){return V(e,r.n,r.supported_modes,r.default_mode,this,t)}})}function N(e,r,a){a=void 0===a?0:+a;var n,o="linear-gradient(",i=[];if(a>0&&(o="repeating-"+o),n=e.match(/^(?:\d*?\.?\d+)deg$/))o+=n[0]+", ";else if(n=e.match(/^to\s+(left|right|top|bottom)(?:\s+(left|right|top|bottom))?$/)){var s=n[1],h=n[2],l={h:{left:0,right:0},v:{top:0,bottom:0}};if(s===h||l.h.hasOwnProperty(s)&&l.h.hasOwnProperty(h)||l.v.hasOwnProperty(s)&&l.v.hasOwnProperty(h))return null;o+=n[0]+", "}for(var p=0;p<r.length;p++)r[p]instanceof t&&i.push(r.length>1?r[p].css()+" "+p/(r.length-1)*100/(0===a?1:a)+"%":r[p].css());return i.length?o+i.join(", ")+")":null}function B(e,r,a){a=void 0===a?0:+a;var n,o="radial-gradient(",i=[];a>0&&(o="repeating-"+o),(n=e.match(/^circle$/))?o+=n[0]+", ":(n=e.match(/^(?:closest|farthest)-(?:side|corner)\s+at\s+(?:\d*?\.?\d+)%\s+(?:\d*?\.?\d+)%$/))&&(o+=n[0]+", ");for(var s=0;s<r.length;s++)r[s]instanceof t&&i.push(r[s].css()+" "+s/(r.length-1)*100/(0===a?1:a)+"%");return i.length?o+i.join(", ")+")":null}var J=t,K=function(){},T=(function(){var t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}(),function(t,e,r){this.owner=t,this.key=e,Array.prototype.push.call(this,+r)});T.prototype=Object.create(Array.prototype),T.prototype.constructor=T,T.prototype.valueOf=function(){return this[0]},T.prototype.concat=function(){return[].concat(this[0],M(arguments))},T.prototype.push=K,T.prototype.pop=K,T.prototype.shift=K,T.prototype.unshift=K,T.prototype.slice=K,T.prototype.splice=K,T.prototype.reverse=K,T.prototype.forEach=K,T.prototype.map=K,T.prototype.reduce=K,T.prototype.reduceRight=K,T.prototype.sort=K,T.prototype.find=K,T.prototype.filter=K,T.prototype.some=K,T.prototype.every=K,T.prototype.includes=K,T.prototype.indexOf=K,T.prototype.lastIndexOf=K,T.prototype.findIndex=K,T.prototype.join=K,T.prototype.keys=K,T.prototype.values=K,T.prototype.entries=K,Object.defineProperty(T.prototype,"scale",{enumerable:!0,get:function(){return this.owner.scales[this.key]}}),Object.defineProperty(T.prototype,"value",{enumerable:!0,set:function(t){this[0]=this.owner[this.key]=+t},get:function(){return this[0]}}),Object.defineProperty(T.prototype,"ratio",{enumerable:!0,set:function(t){var e=this.scale;return this.value=l(+t,e.max,e.min,e.step)},get:function(){var t=this.scale;return s(this[0],t.max,t.min)}}),T.prototype.reverse=function(){return this.ratio=1-this.ratio,this},T.prototype.truncate=function(t){var e=this.scale;return this.value=i(this.value,e.max,e.min,isFinite(t)?t:e.step),this},T.prototype.validate=function(){var t=this.scale;return p(this.value,t.max,t.min,t.step)},T.prototype.as=function(t,e){return e=void 0===e?0:e,l(this.ratio,t,0,e)},t=function(){if(!(this instanceof t))return new(t.bind.apply(t,[null].concat(_(arguments))));var e,r,a;Object.defineProperty(this,"meta",{set:function(t){a=t},get:function(){return a}}),Object.defineProperty(this,"alpha",{enumerable:!0,set:function(t){this.alphaValue=t},get:function(){return new T(this,"alpha",this.alphaValue,t.modes[e].alpha)}}),Object.defineProperty(this,"alphaRatio",{set:function(t){r=t},get:function(){return r}}),Object.defineProperty(this,"alphaValue",{set:function(a){var n=t.modes[e].alpha;r=r=s(a,n.max,n.min)},get:function(){var a=t.modes[e].alpha;return h(r,a.max,a.min)}}),Object.defineProperty(this,"mode",{enumerable:!0,set:function(r){if(!t.modes.hasOwnProperty(r))throw Error(r+" is not a supported color mode.");x(this,e,r),e=r},get:function(){return e}}),Object.defineProperty(this,"modeWithoutKeys",{set:function(r){if(!t.modes.hasOwnProperty(r))throw Error(now+" is not a supported color mode.");f(this,now),void 0!==past&&y(this,past),e=r},get:function(){return e}});var n,o=w(arguments),i=o.string.concat(t.defaultMode);if(o.color.length)this.restore(o.color[0]);else{for(var l=0;l<i.length;l++){if(t.modes.hasOwnProperty(i[l])){this.mode=i[l];break}try{if(n=I(i[l]),n instanceof t)return n}catch(p){}}for(var u=0;u<this.length;u++)this[u]=isFinite(o.number[u])?o.number[u]:this[u];this.alphaValue=isFinite(o.number[u])?o.number[u]:t.modes[e].alpha.max}o=null,i=null},t.prototype=Object.create(Array.prototype),t.prototype.constructor=t,t.prototype.concat=function(){return[].concat(this.array,M(arguments))},t.prototype.push=K,t.prototype.pop=K,t.prototype.shift=K,t.prototype.unshift=K,t.prototype.slice=K,t.prototype.splice=K,t.prototype.reverse=K,t.prototype.forEach=K,t.prototype.map=K,t.prototype.reduce=K,t.prototype.reduceRight=K,t.prototype.sort=K,t.prototype.find=K,t.prototype.filter=K,t.prototype.some=K,t.prototype.every=K,t.prototype.includes=K,t.prototype.indexOf=K,t.prototype.lastIndexOf=K,t.prototype.findIndex=K,t.prototype.join=K,t.prototype.keys=K,t.prototype.values=K,t.prototype.entries=K,Object.defineProperty(t.prototype,"scales",{enumerable:!0,get:function(){return t.modes[this.mode]}}),Object.defineProperty(t.prototype,"in_scale",{enumerable:!0,get:function(){return u(this,0)}}),Object.defineProperty(t.prototype,"array",{enumerable:!0,set:function(t){for(var e=0;e<this.length;e++)this[e]=+t[e]},get:function(){for(var t=this.scales.keys.length,e=Array(t),r=0;t>r;r++)e[r]=this[r];return e}}),Object.defineProperty(t.prototype,"arrayWithAlpha",{enumerable:!0,set:function(t){for(var e=0;e<this.length;e++)this[e]=+t[e];this.alpha=+t[e]},get:function(){return this.array.concat(this.alphaValue)}}),Object.defineProperty(t.prototype,"ratio",{enumerable:!0,set:function(t){for(var e,r=this.scales,a=0;a<this.length;a++)e=r[r.keys[a]],this[a]=h(+t[a],e.max,e.min)},get:function(){for(var t,e=this.scales.keys.length,r=Array(e),a=this.scales,n=0;e>n;n++)t=a[a.keys[n]],r[n]=s(this[n],t.max,t.min);return r}}),Object.defineProperty(t.prototype,"ratioWithAlpha",{enumerable:!0,set:function(t){for(var e,r=this.scales,a=0;a<this.length;a++)e=r[r.keys[a]],this[a]=h(+t[a],e.max,e.min);e=r.alpha,this.alpha=h(+t[a],e.max,e.min)},get:function(){return this.ratio.concat(this.alphaRatio)}}),t.prototype.validate=function(){return u(this)},t.prototype.truncate=function(t){for(var e,r=this.scales,a=0;a<this.length;a++)e=r[r.keys[a]],this[a]=i(this[a],e.max,e.min,isFinite(t)?t:e.step);return this.alphaValue=l(this.alphaRatio,r.alpha.max,r.alpha.min,r.alpha.step),this},t.prototype.reverse=function(){for(var t,e=this.scales,r=0;r<this.length;r++)t=e[e.keys[r]],this[r]=n(t.max-this[r]+t.min,Math.min(a(this[r]),a(t.min)));return this},t.prototype.restore=function(t){return this.mode=t.mode,this.arrayWithAlpha=t.arrayWithAlpha,this},t.prototype.duplicate=function(){return(new t).restore(this)},t.prototype.compare_with=function(e,r){if(e instanceof t){if(r){for(var a=this.arrayWithAlpha,n=e.arrayWithAlpha,o=this.mode===e.mode,i=0;i<a.length;i++)o=o&&a[i]===n[i];return o}for(var a=this.duplicate().truncate().arrayWithAlpha,n=e[this.mode]().arrayWithAlpha,o=!0,i=0;i<a.length;i++)o=o&&a[i]===n[i];return o}return!1},t.prototype.to=function(t,e){return j(this,t,e)},t.prototype.toString=function(t,e,r){var a=this.mode,n=[];r=r||" ",t&&(a+="a"),isFinite(e)&&(e=Math.round(e));for(var o=0;o<this.length;o++){for(n[o]=""+this[o];e&&n[o].length<e;)n[o]=r+n[o];n[o]=n[o].substr(0,e)}if(t){for(n[o]=""+this.alphaRatio;e&&n[o].length<e;)n[o]=r+n[o];n[o]=n[o].substr(0,e)}return a+"( "+n.join(", ")+" )"},t.prototype.serialize=function(){return[this.mode].concat(this.arrayWithAlpha)},Object.defineProperty(t,"fn",{enumerable:!0,writable:!0,value:{}}),t.fn.set_xyz_illuminant=function(e){return"string"==typeof e&&t.modes.xyz.illuminant.hasOwnProperty(e)?(t.modes.xyz.illuminant.current=e,t.modes.xyz.x.max=t.modes.xyz.illuminant[e].x,t.modes.xyz.y.max=t.modes.xyz.illuminant[e].y,t.modes.xyz.z.max=t.modes.xyz.illuminant[e].z,e):t.modes.xyz.illuminant.current};var U=function(){if(!(this instanceof U))throw TypeError("constructor ColorSet requires 'new'");var e=w(arguments),r=e.color.length?e.color[0].mode:t.defaultMode,a=t.modes[r].length;Object.defineProperty(this,"mode",{enumerable:!0,set:function(e){if(!t.modes.hasOwnProperty(e))throw Error(e+" is not a supported color mode.");r=e},get:function(){return r}}),this.width=isFinite(e.number[0])?e.number[0]:e.color.length,this.height=isFinite(e.number[1])?e.number[1]:isFinite(e.number[0])?Math.ceil(e.color.length/width):1,this.data=new Float64Array(this.width*this.height*a);for(var n=0;n<e.color.length;n++)this.data.set(A(e.color[n].arrayWithAlpha,t.converters.matrix[e.color[n].mode][r]),n*a);e=null};return U.prototype.valueOf=function(){return this.data},U.prototype.toString=function(){return'{ "mode": "'+this.mode+'",\n"width": '+this.width+',\n"height": '+this.height+',\n"data": [\n'+this.get_colors(0,this.length).map(function(t){return"	[ "+t.arrayWithAlpha.join(", ")+" ]"}).join(",\n")+"\n] }"},Object.defineProperty(U.prototype,"keyLength",{enumerable:!0,get:function(){return t.modes[this.mode].length}}),Object.defineProperty(U.prototype,"size",{enumerable:!0,get:function(){return this.data.length/this.keyLength}}),Object.defineProperty(U.prototype,"length",{enumerable:!0,get:function(){for(var t=this.data.length;t&&!this.data[--t];);return Math.ceil(t/this.keyLength)}}),U.prototype.to=function(e){if(e!==this.mode&&t.modes.hasOwnProperty(e)&&t.converters.matrix[this.mode][e].length){for(var r=t.converters.matrix[this.mode][e],a=t.modes[e].length,n=this.length,o=new Float64Array(this.size*a),i=0;n>i;i++)o.set(A(this.get_array(i),r),i*a);this.mode=e,this.data=o}return this},U.prototype.duplicate=function(){var t=new U;return t.mode=this.mode,t.adjust_size(this.width,this.height),t.data.set(this.data),t},U.prototype.restore=function(t){return t instanceof U?(this.mode=t.mode,this.adjust_size(t.width,t.height),this.data.set(t.data),this):void 0},U.prototype.truncate=function(e){for(var r,a=t.modes[this.mode],n=0;n<a.length;n++){r=a[a.keys[n]]||a.alpha;for(var o=0;o<this.length;o++)this.data[o*this.keyLength+n]=i(this.data[o*this.keyLength+n],r.max,r.min,isFinite(e)?e:r.step)}return this},U.prototype.adjust_size=function(t,e){isFinite(t)||isFinite(e)?isFinite(t)?isFinite(e)||(t=t,e=Math.ceil(this.length/t)):(t=Math.ceil(this.length/e),e=e):(t=this.length,e=1);var r=new Float64Array(t*e*this.keyLength);return r.set(this.data.slice(0,r.length)),this.width=t,this.height=e,this.data=r,this},U.prototype.toImageData=function(){for(var e=new ImageData(this.width,this.height),r=t.converters.matrix[this.mode].rgb,a=0;a<this.size;a++)e.data.set(A(this.get_array(a),r),4*a);return e},U.prototype.get_array=function(t){var e=this.keyLength,r=Array(e);t=(+t>>0)*e;for(var a=0;e>a;a++)r[a]=this.data[t+a];return r},U.prototype.set_array=function(t,e){return this.data.set(e,(+t>>0)*this.keyLength),this.get_colors(t)},U.prototype.set_color=function(t,e){return this.set_array(t,e[this.mode](0).arrayWithAlpha)},U.prototype.set_colors=function(t,e){for(var r=0;r<e.length;r++)this.set_color(t+r,e[r]);return this.get_colors(t,e.length)},U.prototype.get_colors=function(e,r){r=isFinite(e)?isFinite(r)?+r>>0:1:this.size,e=isFinite(e)?+e>>0:0;var a=Array(r);if(e>=0&&e+r<=this.size){for(var n=0;r>n;n++)a[n]=new t,a[n].mode=this.mode,a[n].arrayWithAlpha=this.get_array(e+n);return a}return[]},U.prototype.insert=function(t,e){if(t instanceof U){var r=this.keyLength;e=0>e||e>this.length?this.data.length:(+e>>0)*r;var a=this.data.subarray(0,e),n=this.data.subarray(e,this.data.length),o=new Float64Array(this.data.length+t.data.length);o.set(a),o.set(t.data,a.length),o.set(n,a.length+t.data.length),this.height=Math.ceil(o.length/this.keyLength/this.width),this.data=o}return this.data},U.prototype.average=function(){for(var e=t.fn.average.modes.hasOwnProperty(this.mode)?this.mode:t.fn.average.default_mode,r=new t(e),a=Array(this.length),n=this.length,o=0;n>o;o++)a[o]=A(this.get_array(o),t.converters.matrix[this.mode][e]);return r.arrayWithAlpha=t.fn.average.modes[e](a),r.truncate(1e-12),r},U.prototype.get_key_map=function(e){if(-1!==t.modes[this.mode].keys.indexOf(e)||"alpha"===e){for(var r=this.keyLength,a=this.length,n=Array(a),o=t.modes[this.mode][e].index,i=0;a>i;i++)n[i]=this.data[i*r+o];return n}return null},U.prototype.set_key_map=function(e,r){if(-1!==t.modes[this.mode].keys.indexOf(e)||"alpha"===e)for(var a=this.keyLength,n=t.modes[this.mode][e].index,o=this.size,i=0;o>i;i++)this.data[i*a+n]=+r[i]||0;return this},U.prototype.get_key_contrast_map=function(t){var e=this.get_key_map(t);if(Array.isArray(e)){var r=e.reduce(function(t,e){return t+e},0)/e.length;return e.map(function(t){return r-t})}return null},U.prototype.get_distance_map=function(){for(var e=this.width,r=this.height,a=Array(e*r),n=0,o=new t(this.mode),i=new t(this.mode),s=0,h=0,l=0;r>l;l++)for(var p=0;e>p;p++)n=l*e+p,s=h=0,o.arrayWithAlpha=this.get_array(n),0!==l&&(i.arrayWithAlpha=this.get_array(n-e),s=o.distance(i)/4,a[n-e]+=s,a[n]+=s),0!==p&&(i.arrayWithAlpha=this.get_array(n-1),h=o.distance(i)/4,a[n-1]+=h,a[n]+=h),a[n]=s+h;return a},U.prototype.edge_map=function(){var t=new U,e=this.get_distance_map().map(function(t){return 255*t});return t.adjust_size(this.width,this.height),t.set_key_map("r",e),t.set_key_map("g",e),t.set_key_map("b",e),t.set_key_map("alpha",Array(this.size).fill(255)),t},U.prototype.analyse=function(){for(var e=t.modes[this.mode],r=e.length,a=Array(r),o=this.length,i=1,s={},h=0;r>h;h++){var l=e.keys[h]||"alpha",p=e[l],u=0===p.step?p.range<100?100:p.range:p.range/p.step;a[h]={key:l,step:p.range/u,rank:u,values:Array(u+1),total:0,mean:0},i*=u+1}for(var m=[],c=[],y=Math.pow(2,32)-1,d=Array(r),f=[],g=0,v=0;i>0;v++)m[v]=Array(i>y?y:i),i-=y;i=0;for(var b=0;o>b;b++){var x=1,_=0,M=0;for(h=0;r>h;h++){var w=b*r+h,z=Math.round(this.data[w]/a[h].step);a[h].values[z]=(isFinite(a[h].values[z])?a[h].values[z]:0)+1,a[h].total+=this.data[w],_+=z*x,x*=a[h].rank+1}M=_/y>>0,_%=y,m[M][_]={v:_,n:(m[M][_]?m[M][_].n:0)+1}}for(h=0;r>h;h++){var k=a[h].values.length,P=0,O=0;a[h].mean=a[h].total/o,a[h].ao=Array(k);for(var b=0;k>b;b++)isNaN(a[h].values[b])&&(a[h].values[b]=0),O+=a[h].values[b],isFinite(a[h].median)||(o%2?(o+1)/2>O||(a[h].median=b*a[h].step):o/2+1>O||(a[h].median=O-a[h].values[b]===o/2?(b-.5)*a[h].step:b*a[h].step)),a[h].ao[b]={v:b,n:a[h].values[b]};a[h].ao.sort(function(t,e){return e.n-t.n||t.v-e.v});for(var b=1;k>b;b++)if(a[h].ao[b-1].n>a[h].ao[b].n){a[h].mode=a[h].ao.slice(0,b).map(function(t){return t.v*a[h].step});break}void 0===a[h].mode&&(a[h].mode=a[h].ao.map(function(t){return t.v*a[h].step}));for(var b=0;o>b;b++)P+=Math.pow(this.data[b*r+h]-a[h].mean,2);a[h].sd=Math.pow(P/o,.5),a[h].values=a[h].ao,d[h]=a[h].mean}for(v=0;v<m.length;v++){var A=Object.keys(m[v]),j=Array(A.length);for(b=0;b<A.length;b++){var I=Array(r),F=m[v][A[b]].v,x=1;for(h=0;r>h;h++){var W=a[h].rank+1;I[h]=F%W,F=(F-I[h])/W}m[v][A[b]].v=I,j[b]=m[v][A[b]]}m[v]=j.sort(function(t,e){return e.n-t.n||t.v-e.v});for(var b=1;b<m[v].length;b++)for(0===f.length?m[v][b-1].n>m[v][b].n&&(f=m[v].slice(0,b)):m[v][b-1].n>m[v][b].n&&(m[v][b-1].n>f[0].n?f=m[v].slice(0,b):m[v][b-1].n===f[0].n&&(f=f.concat(m[v].slice(0,b)))),h=0;r>h;h++)g+=m[v][b].n*Math.pow(m[v][b].v[h]-d[h],2)/r;!m[v].length||m[v][b-1].n!==m[v][0].n||0!==f.length&&f[0].n!==m[v][0].n||(f=f.concat(m[v])),i+=m[v].length}if(f=f.map(function(t){return t.v}),g=Math.pow(g/o,.5),y>=i){for(v=1;v<m.length;v++)m[0]=m[0].concat(m[v]);m=m[0].sort(function(t,e){return e.n-t.n||t.v-e.v})}c=m.slice(0,m.length);var E,R,q=Array(4),V=new t(this.mode),L=new t(this.mode),$=o;for(b=0;$&&c.length;b++){for(E=R=c[0].n,L.arrayWithAlpha=c[0].v,c.shift(),v=0;v<c.length;v++)if(V.arrayWithAlpha=c[v].v,V.alphaValue=e.alpha.max,R+=c[v].n,L.distance(V)<=.1-.06*R/$){for(I=L.arrayWithAlpha.map(function(t){return t*E}),h=0;r>h;h++)l=e.keys[h]||"alpha",p=e[l],I[h]=(I[h]+c[v].v[h]*c[v].n)/(c[v].n+E),p.loop&&(I[h]+=Math.abs(c[v].v[h]-L[h])<p.range/2?p.range/2:0,I[h]=(I[h]+p.range)%p.range);E+=c[v].n,c.splice(v,1),v--}$-=E,q[b]={n:E,v:L.arrayWithAlpha}}for(q.sort(function(t,e){return e.n-t.n||t.v-e.v}),v=0;v<q.length;v++)if(0===q[v].v[r-1]){q.splice(v,1);break}var q=q.slice(0,q.length);L.arrayWithAlpha=d,L.alphaValue=e.alpha.max,q=q.map(function(t){return V.arrayWithAlpha=t.v,V.alphaValue=e.alpha.max,t.d=L.distance(V),t}).sort(function(t,e){return n(e.d-t.d,-2)||e.n-t.n});for(var S=[q[0]],C=q.slice(1,q.length),D=1/(8-Math.log2(m.length)/4);C.length;)L.arrayWithAlpha=C[0].v,L.alphaValue=e.alpha.max,S.reduce(function(t,r){return t?(V.arrayWithAlpha=r.v,V.alphaValue=e.alpha.max,L.distance(V)>D):t},!0)&&C[0].n>Math.log10(o)?S.push(C.shift()):C.shift();for(S.sort(function(t,e){return e.n-t.n||t.d-e.d}),c.sort(function(t,e){return e.n-t.n||t.d-e.d}),h=0;r>h;h++)s[a[h].key]=a[h],delete a[h].key,delete a[h].ao,delete a[h].total,delete a[h].rank,delete a[h].step;return{mean:d,mode:f,sd:g,values:m,keys:s,km:q,rs:S}},Object.defineProperty(U,"fn",{enumerable:!0,writable:!0,value:{}}),U.fn.parseString=function(e){try{var r=JSON.parse(e),a=new U,n=new Float64Array(r.data.length*t.modes[r.mode].length);a.mode=r.mode;for(var o,i=a.keyLength;o<r.data.length;o++)n.set(r.data[o],o*i);return a.data=n,a.adjust_size(r.width,r.height),a}catch(s){return console.log(s),null}},U.fn.readImageData=function(t){if(t instanceof ImageData){var e=new U;return e.adjust_size(t.width,t.height),e.data.set(t.data),e}},Object.defineProperty(t,"defaultMode",{enumerable:!0,value:"rgb"}),Object.defineProperty(t,"defaultIlluminant",{enumerable:!0,value:"d65_2"}),t.modes={grayscale:{keys:["g"],g:{index:0,min:0,max:1,step:0},alpha:{index:1,min:0,max:1,step:0}},rgb:{keys:["r","g","b"],r:{index:0,min:0,max:255,step:1},g:{index:1,min:0,max:255,step:1},b:{index:2,min:0,max:255,step:1},alpha:{index:3,min:0,max:255,step:1}},hsl:{keys:["h","s","l"],h:{index:0,min:0,max:360,step:1,loop:!0},s:{index:1,min:0,max:100,step:1},l:{index:2,min:0,max:100,step:1},alpha:{index:3,min:0,max:100,step:1}},hsv:{keys:["h","s","v"],h:{index:0,min:0,max:360,step:1,loop:!0},s:{index:1,min:0,max:100,step:1},v:{index:2,min:0,max:100,step:1},alpha:{index:3,min:0,max:100,step:1}},cmyk:{keys:["c","m","y","k"],c:{index:0,min:0,max:100,step:1},m:{index:1,min:0,max:100,step:1},y:{index:2,min:0,max:100,step:1},k:{index:3,min:0,max:100,step:1},alpha:{index:4,min:0,max:100,step:1}},xyz:{illuminant:{c_2:{x:98.074,y:100,z:118.232},c_10:{x:97.285,y:100,z:116.145},d50_2:{x:96.422,y:100,z:82.521},d50_10:{x:96.72,y:100,z:81.427},d65_2:{x:95.047,y:100,z:108.883},d65_10:{x:94.811,y:100,z:107.304},e_2:{x:100,y:100,z:100},current:t.defaultIlluminant},convert_matrix:{c_2:{rgb_xyz:{rx:.6068909,gx:.1735011,bx:.200348,ry:.2989164,gy:.586599,by:.1144845,rz:0,gz:.0660957,bz:1.1162243},xyz_rgb:{xr:1.9099961,yr:-.5324542,zr:-.2882091,xg:-.9846663,yg:1.999171,zg:-.0283082,xb:.0583056,yb:-.1183781,zb:.8975535}},c_10:{rgb_xyz:{rx:.6068909,gx:.1735011,bx:.200348,ry:.2989164,gy:.586599,by:.1144845,rz:0,gz:.0660957,bz:1.1162243},xyz_rgb:{xr:1.9099961,yr:-.5324542,zr:-.2882091,xg:-.9846663,yg:1.999171,zg:-.0283082,xb:.0583056,yb:-.1183781,zb:.8975535}},d50_2:{rgb_xyz:{rx:.4360747,gx:.3850649,bx:.1430804,ry:.2225045,gy:.7168786,by:.0606169,rz:.0139322,gz:.0971045,bz:.7141733},xyz_rgb:{xr:3.1338561,yr:-1.6168667,zr:-.4906146,xg:-.9787684,yg:1.9161415,zg:.033454,xb:.0719453,yb:-.2289914,zb:1.4052427}},d50_10:{rgb_xyz:{rx:.4360747,gx:.3850649,bx:.1430804,ry:.2225045,gy:.7168786,by:.0606169,rz:.0139322,gz:.0971045,bz:.7141733},xyz_rgb:{xr:3.1338561,yr:-1.6168667,zr:-.4906146,xg:-.9787684,yg:1.9161415,zg:.033454,xb:.0719453,yb:-.2289914,zb:1.4052427}},d65_2:{rgb_xyz:{rx:.4124564,gx:.3575761,bx:.1804375,ry:.2126728,gy:.7151522,by:.072175,rz:.0193339,gz:.119192,bz:.9503041},xyz_rgb:{xr:3.24045483602141,yr:-1.53713885010258,zr:-.498531546868481,xg:-.969266389875654,yg:1.87601092884249,zg:.041556082346674,xb:.055643419604214,yb:-.204025854267698,zb:1.05722516245793}},d65_10:{rgb_xyz:{rx:.4124564,gx:.3575761,bx:.1804375,ry:.2126729,gy:.7151522,by:.072175,rz:.0193339,gz:.119192,bz:.9503041},xyz_rgb:{xr:3.2404542,yr:-1.5371385,zr:-.4985314,xg:-.969266,yg:1.8760108,zg:.041556,xb:.0556434,yb:-.2040259,zb:1.0572252}},e_2:{rgb_xyz:{rx:.488718,gx:.3106803,bx:.2006017,ry:.1762044,gy:.8129847,by:.0108109,rz:0,gz:.0102048,bz:.9897952},xyz_rgb:{xr:2.3706743,yr:-.9000405,zr:-.4706338,xg:-.513885,yg:1.4253036,zg:.0885814,xb:.0052982,yb:-.0146949,zb:1.0093968}}},keys:["x","y","z"],x:{index:0,min:0,max:95.047,step:0},y:{index:1,min:0,max:100,step:0},z:{index:2,min:0,max:108.883,step:0},alpha:{index:3,min:0,max:1,step:0}},lab:{keys:["l","a","b"],l:{index:0,min:0,max:100,step:0},a:{index:1,min:-128,max:127,step:0},b:{index:2,min:-128,max:127,step:0},alpha:{index:3,min:0,max:1,step:0}},luv:{keys:["l","u","v"],l:{index:0,min:0,max:100,step:0},u:{index:1,min:-100,max:100,step:0},v:{index:2,min:-100,max:100,step:0},alpha:{index:3,min:0,max:1,step:0}},lch:{keys:["l","c","h"],l:{index:0,min:0,max:100,step:0},c:{index:1,min:0,max:128,step:0},h:{index:2,min:0,max:360,step:0,loop:!0},alpha:{index:3,min:0,max:1,step:0}},lms:{keys:["l","m","s"],l:{index:0,min:-1,max:1,step:0},m:{index:1,min:-1,max:1,step:0},s:{index:2,min:-1,max:1,step:0},alpha:{index:3,min:0,max:1,step:0},convert_matrix:{d65_2:{rgb_lms:{rl:.31268637,gl:.60610913,bl:.08120451,rm:.13488348,gm:.73163262,bm:.13348391,rs:.02677835,gs:.10859105,bs:.86463061},lms_rgb:{lr:4.97068857,mr:-4.14354132,sr:.17285275,lg:-.90913894,mg:2.15671326,sg:-.24757432,lb:-.03976551,mb:-.14253782,sb:1.18230333}}}},dkl:{keys:["elevation","azimuth","contrast"],elevation:{index:0,min:-90,max:90,step:0},azimuth:{index:1,min:0,max:360,step:0,loop:!0},contrast:{index:2,min:0,max:1,step:0},alpha:{index:3,min:0,max:1,step:0},convert_matrix:{d65_2:{rgb_dkl:{rz:.25145542,gz:.64933633,bz:.09920825,rx:.78737943,gx:-.55586618,bx:-.23151325,ry:.26562825,gy:.63933074,by:-.90495899},dkl_rgb:{zr:1,xr:1,yr:-.1462,zg:1,xg:-.39,yg:.2094,zb:1,xb:.018,yb:-1}}}}},F(),t.converters={hex:{path_exclude:!0,rgb:{from:{mode:"hex",type:"string"},to:{mode:"rgb",type:"array"},fn:function(e){var r,a,n,o=(""+e).match(/^#([0-9A-Fa-f]{3})$/);if(o)r="0x"+o[1][0]+o[1][0],a="0x"+o[1][1]+o[1][1],n="0x"+o[1][2]+o[1][2];else{if(!(o=(""+e).match(/^#([0-9A-Fa-f]{6})$/)))return null;r="0x"+o[1].substr(0,2),a="0x"+o[1].substr(2,2),n="0x"+o[1].substr(4,2)}return new t(+r,+a,+n)}}},css:{path_exclude:!0,rgb:{from:{mode:"css",type:"string"},to:{mode:"rgb",type:"array"},fn:function(e){var r,a,n,o,i,s=(""+e).match(/^rgb\(\s*([0-1]?[0-9]?[0-9]|2(?:[0-4][0-9]|5[0-5])),\s*([0-1]?[0-9]?[0-9]|2(?:[0-4][0-9]|5[0-5])),\s*([0-1]?[0-9]?[0-9]|2(?:[0-4][0-9]|5[0-5]))\s*\);?$/);if(s)r=+s[1],a=+s[2],n=+s[3];else{if(!(s=(""+e).match(/^rgba\(\s*([0-1]?[0-9]?[0-9]|2(?:[0-4][0-9]|5[0-5])),\s*([0-1]?[0-9]?[0-9]|2(?:[0-4][0-9]|5[0-5])),\s*([0-1]?[0-9]?[0-9]|2(?:[0-4][0-9]|5[0-5])),\s*(1|0|0?\.\d+)\s*\);?$/)))return null;r=+s[1],a=+s[2],n=+s[3],o=+s[4]}return i=new t(r,a,n),"number"==typeof o&&(i.alphaRatio=o),i}},hsl:{from:{mode:"css",type:"string"},to:{mode:"hsl",type:"array"},fn:function(e){var r,a,n,o,i,s=(""+e).match(/^hsl\(\s*(-?\d*\.?\d+),\s*(-?\d*\.?\d+)%,\s*(-?\d*\.?\d+)%\s*\)$/);if(s)r=+s[1]%360,r+=0>r?360:0,a=+s[2],n=+s[3];else{if(!(s=(""+e).match(/^hsla\(\s*(-?\d*\.?\d+),\s*(-?\d*\.?\d+)%,\s*(-?\d*\.?\d+)%,\s*(1|0|0?\.\d+)\s*\)$/)))return null;r=+s[1]%360,r+=0>r?360:0,a=+s[2],n=+s[3],o=+s[4]}return i=new t(r,a,n,"hsl"),"number"==typeof o&&(i.alphaRatio=o),i}}},grayscale:{path_exclude:!0,rgb:{from:{mode:"grayscale",type:"array"},to:{mode:"rgb",type:"ratio"},fn:function(t){return[t[0],t[0],t[0],t[1]]}}},rgb:{hex:{from:{mode:"rgb",type:"array"},to:{mode:"hex",type:"string"},fn:function(e){var r=t.modes.rgb,a=i(e[0],r.r.max,r.r.min,r.r.step),n=i(e[1],r.g.max,r.g.min,r.g.step),o=i(e[2],r.b.max,r.b.min,r.b.step);return("#"+("0"+a.toString(16)).substr(-2)+("0"+n.toString(16)).substr(-2)+("0"+o.toString(16)).substr(-2)).toUpperCase()}},css:{from:{mode:"rgb",type:"array"},to:{mode:"css",type:"string"},fn:function(e){var r=t.modes.rgb,a=i(e[0],r.r.max,r.r.min,r.r.step),n=i(e[1],r.g.max,r.g.min,r.g.step),o=i(e[2],r.b.max,r.b.min,r.b.step),h=s(e[3],r.alpha.max,r.alpha.min,r.alpha.step);return 1===h?"rgb( "+a+", "+n+", "+o+" )":"rgba( "+a+", "+n+", "+o+", "+h+" )"}},hsv:{from:{mode:"rgb",type:"ratio"},to:{mode:"hsv",type:"ratio"},fn:function(t){var e,r,a=t[0],n=t[1],o=t[2],i=Math.max(a,n,o),s=Math.min(a,n,o),h=i-s,l=i;if(0!=h){switch(r=h/i,t.indexOf(i)){case 0:e=(n-o)/h;break;case 1:e=(o-a)/h+2;break;case 2:e=(a-n)/h+4}e/=6,e=++e%1}else r=0,e=0;return[e,r,l,t[3]]}},hsl:{from:{mode:"rgb",type:"ratio"},to:{mode:"hsl",type:"ratio"},fn:function(t){var e,r,a=t[0],n=t[1],o=t[2],i=Math.max(a,n,o),s=Math.min(a,n,o),h=i-s,l=i+s,p=l/2;if(0!==h){switch(r=.5>p?h/l:h/(2-l),t.indexOf(i)){case 0:e=(n-o)/h;break;case 1:e=(o-a)/h+2;break;case 2:e=(a-n)/h+4}e/=6,e=++e%1}else r=0,e=0;return[e,r,p,t[3]]}},cmyk:{from:{mode:"rgb",type:"ratio"},to:{mode:"cmyk",type:"ratio"},fn:function(t){var e,r,a,n=t[0],o=t[1],i=t[2],s=Math.max(n,o,i),h=1-s;return 0===s?(e=0,r=0,a=0):(e=(s-n)/s,r=(s-o)/s,a=(s-i)/s),[e,r,a,h,t[3]]}},xyz:{from:{mode:"rgb",type:"ratio"},to:{mode:"xyz",type:"array"},fn:function(e){var r=e[0],a=e[1],n=e[2],o=t.modes.xyz,i=o.convert_matrix[o.illuminant.current].rgb_xyz,s=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,h=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,l=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,p=100*(s*i.rx+h*i.gx+l*i.bx),u=100*(s*i.ry+h*i.gy+l*i.by),m=100*(s*i.rz+h*i.gz+l*i.bz);return[p,u,m,e[3]]}},lms:{from:{mode:"rgb",type:"ratio"},to:{mode:"lms",type:"array"},fn:function(e){var r=e[0],a=e[1],n=e[2],o=t.modes.lms.convert_matrix[t.modes.xyz.illuminant.current].rgb_lms||t.modes.lms.convert_matrix.d65_2.rgb_lms,i=r*o.rl+a*o.gl+n*o.bl,s=r*o.rm+a*o.gm+n*o.bm,h=r*o.rs+a*o.gs+n*o.bs;return[i,s,h,e[3]]}},dkl:{from:{mode:"rgb",type:"ratio"},to:{mode:"dkl",type:"array"},fn:function(e){var r=e[0],a=e[1],n=e[2],o=t.modes.dkl.convert_matrix[t.modes.xyz.illuminant.current].rgb_dkl||t.modes.dkl.convert_matrix.d65_2.rgb_dkl,i=r*o.rz+a*o.gz+n*o.bz,s=r*o.rx+a*o.gx+n*o.bx,h=r*o.ry+a*o.gy+n*o.by,l=180*Math.atan2(i,Math.sqrt(Math.pow(s,2)+Math.pow(h,2)))/Math.PI,p=180*Math.atan2(h,s)/Math.PI,u=Math.sqrt(Math.pow(s,2)+Math.pow(h,2)+Math.pow(i,2));
return[l,p,u,e[3]]}},grayscale:{from:{mode:"rgb",type:"ratio"},to:{mode:"grayscale",type:"array"},fn:function(t){return[(t[0]+t[1]+t[2])/3,t[3]]}}},hsl:{css:{from:{mode:"hsl",type:"array"},to:{mode:"css",type:"string"},fn:function(e){var r=t.modes.hsl.alpha,a=e[0],n=e[1],o=e[2],i=s(e[3],r.max,r.min);return 1===i?"hsl( "+a+", "+n+"%, "+o+"% )":"hsla( "+a+", "+n+"%, "+o+"%, "+i+" )"}},rgb:{from:{mode:"hsl",type:"ratio"},to:{mode:"rgb",type:"ratio"},fn:function(t){var e,r,a,n=t[0],o=t[1],i=t[2];if(0===o)return[i,i,i,t[3]];var s=.5>i?i*(1+o):o+i-o*i,h=2*i-s,l=s-h;switch(Math.floor(6*n)){case 0:e=s,r=h+6*l*n,a=h;break;case 1:e=h-6*l*n+2*l,r=s,a=h;break;case 2:e=h,r=s,a=h+6*l*n-2*l;break;case 3:e=h,r=h-6*l*n+4*l,a=s;break;case 4:e=h+6*l*n-4*l,r=h,a=s;break;case 5:e=s,r=h,a=h-6*l*n+6*l;break;case 6:e=s,r=h+6*l*n-6*l,a=h}return[e,r,a,t[3]]}},grayscale:{from:{mode:"hsl",type:"ratio"},to:{mode:"grayscale",type:"array"},fn:function(t){return[t[2],t[3]]}}},hsv:{rgb:{from:{mode:"hsv",type:"ratio"},to:{mode:"rgb",type:"ratio"},fn:function(t){var e,r,a,n=6*t[0],o=t[1],i=t[2];switch(Math.floor(n)){case 0:e=i,r=(1+(n-1)*o)*i,a=(1-o)*i;break;case 1:e=(1+(1-n)*o)*i,r=i,a=(1-o)*i;break;case 2:e=(1-o)*i,r=i,a=(1+(n-3)*o)*i;break;case 3:e=(1-o)*i,r=(1+(3-n)*o)*i,a=i;break;case 4:e=(1+(n-5)*o)*i,r=(1-o)*i,a=i;break;case 5:e=i,r=(1-o)*i,a=(1+(5-n)*o)*i;break;case 6:e=i,r=(1+(n-7)*o)*i,a=(1-o)*i}return[e,r,a,t[3]]}},grayscale:{from:{mode:"hsv",type:"ratio"},to:{mode:"grayscale",type:"array"},fn:function(t){return[t[2],t[3]]}}},cmyk:{rgb:{from:{mode:"cmyk",type:"ratio"},to:{mode:"rgb",type:"ratio"},fn:function(t){var e=t[0],r=t[1],a=t[2],n=t[3],o=(1-e)*(1-n),i=(1-r)*(1-n),s=(1-a)*(1-n);return[o,i,s,t[4]]}},grayscale:{from:{mode:"cmyk",type:"ratio"},to:{mode:"grayscale",type:"array"},fn:function(t){return[1-t[3],t[4]]}}},xyz:{rgb:{from:{mode:"xyz",type:"array"},to:{mode:"rgb",type:"ratio"},fn:function(e){var r=t.modes.xyz,a=e[0]/100,n=e[1]/100,o=e[2]/100,i=r.convert_matrix[r.illuminant.current].xyz_rgb,s=a*i.xr+n*i.yr+o*i.zr,h=a*i.xg+n*i.yg+o*i.zg,l=a*i.xb+n*i.yb+o*i.zb,p=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s;return g=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:12.92*h,b=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:12.92*l,[p,g,b,e[3]]}},lab:{from:{mode:"xyz",type:"ratio"},to:{mode:"lab",type:"array"},fn:function(e){var r=e[0],a=e[1],n=e[2],o=(t.modes.lab,r>216/24389?Math.pow(r,1/3):(24389/27*r+16)/116),i=a>216/24389?Math.pow(a,1/3):(24389/27*a+16)/116,s=n>216/24389?Math.pow(n,1/3):(24389/27*n+16)/116,h=116*i-16,l=500*(o-i),p=200*(i-s);return[h,l,p,e[3]]}},luv:{from:{mode:"xyz",type:"array"},to:{mode:"rgb",type:"array"},fn:function(e){var r=t.modes.xyz,a=(t.modes.luv,r.x.max),n=r.y.max,o=r.z.max,i=e[0],s=e[1],h=e[2],l=s/100,p=4*i/(i+15*s+3*h)||0,u=9*s/(i+15*s+3*h)||0,m=l>216/24389?116*Math.pow(l,1/3)-16:24389/27*l,c=13*m*(p-4*a/(a+15*n+3*o)),y=13*m*(u-9*n/(a+15*n+3*o));return[m,c,y,e[3]]}},grayscale:{from:{mode:"xyz",type:"ratio"},to:{mode:"grayscale",type:"array"},fn:function(t){return[t[1],t[3]]}}},lab:{xyz:{from:{mode:"lab",type:"array"},to:{mode:"xyz",type:"ratio"},fn:function(e){var r=(t.modes.lab,(e[0]+16)/116),a=r+e[1]/500,n=r-e[2]/200,o=Math.pow(a,3)>216/24389?Math.pow(a,3):(116*a-16)/24389*27,i=Math.pow(r,3)>216/24389?Math.pow(r,3):(116*r-16)/24389*27,s=Math.pow(n,3)>216/24389?Math.pow(n,3):(116*n-16)/24389*27;return[o,i,s,e[3]]}},lch:{from:{mode:"lab",type:"array"},to:{mode:"lch",type:"array"},fn:function(e){var r=(t.modes.lab,t.modes.lch,e[0]),a=e[1],n=e[2],o=Math.sqrt(Math.pow(a,2)+Math.pow(n,2)),i=Math.atan2(n,a),s=180*(i>0?i/Math.PI:2-Math.abs(i)/Math.PI);return[r,o,s,e[3]]}},grayscale:{from:{mode:"lab",type:"array"},to:{mode:"grayscale",type:"array"},fn:function(e){var r=t.converters.xyz.rgb.fn(t.converters.ratio.array.fn("xyz",t.converters.lab.xyz.fn([e[0],0,0,e[3]])));return[r[0],r[3]]}}},luv:{xyz:{from:{mode:"luv",type:"array"},to:{mode:"xyz",type:"array"},fn:function(e){var r=(t.modes.luv,t.modes.xyz,e[0]),a=e[1],n=e[2],o=t.modes.xyz.x.max,i=t.modes.xyz.y.max,s=t.modes.xyz.z.max,h=a/(13*r)+4*o/(o+15*i+3*s),l=n/(13*r)+9*i/(o+15*i+3*s),p=(r+16)/116,u=100*(Math.pow(p,3)>216/24389?Math.pow(p,3):(p-16/116)/7.787),m=9/4*u*h/l||0,c=(3*u/l||0)-5*u-m/3;return[m,u,c,e[3]]}},grayscale:{from:{mode:"luv",type:"array"},to:{mode:"grayscale",type:"array"},fn:function(e){var r=t.converters.xyz.rgb.fn(t.converters.luv.xyz.fn([e[0],0,0,e[3]]));return[r[0],r[3]]}}},lch:{lab:{from:{mode:"lch",type:"array"},to:{mode:"lab",type:"array"},fn:function(e){var r=(t.modes.lch,t.modes.lab,e[0]),a=e[1],n=e[2],o=Math.cos(n*Math.PI/180)*a,i=Math.sin(n*Math.PI/180)*a;return[r,o,i,e[3]]}},grayscale:{from:{mode:"lch",type:"array"},to:{mode:"grayscale",type:"array"},fn:function(e){var r=t.converters.xyz.rgb.fn(t.converters.ratio.array.fn("xyz",t.converters.lab.xyz.fn([e[0],0,0,e[3]])));return[r[0],r[3]]}}},lms:{rgb:{from:{mode:"lms",type:"array"},to:{mode:"rgb",type:"ratio"},fn:function(e){var r=e[0],a=e[1],n=e[2],o=t.modes.lms.convert_matrix[t.modes.xyz.illuminant.current].lms_rgb||t.modes.lms.convert_matrix.d65_2.lms_rgb,i=r*o.lr+a*o.mr+n*o.sr,s=r*o.lg+a*o.mg+n*o.sg,h=r*o.lb+a*o.mb+n*o.sb;return[i,s,h,e[3]]}}},dkl:{rgb:{from:{mode:"dkl",type:"array"},to:{mode:"rgb",type:"ratio"},fn:function(e){var r=e[0]/180*Math.PI,a=e[1]/180*Math.PI,n=e[2],o=t.modes.dkl.convert_matrix[t.modes.xyz.illuminant.current].dkl_rgb||t.modes.dkl.convert_matrix.d65_2.dkl_rgb,i=n*Math.cos(r)*Math.cos(a),s=n*Math.cos(r)*Math.sin(a),h=n*Math.sin(r),l=h*o.zr+i*o.xr+s*o.yr,p=h*o.zg+i*o.xg+s*o.yg,u=h*o.zb+i*o.xb+s*o.yb;return[l,p,u,e[3]]}},grayscale:{from:{mode:"dkl",type:"array"},to:{mode:"grayscale",type:"array"},fn:function(e){var r=t.converters.ratio.array.fn(t.converters.dkl.rgb.fn([e[0],0,0,e[3]]));return[r[0],r[3]]}}},ratio:{path_exclude:!0,array:{from:{mode:"ratio",type:"array"},to:{mode:"array",type:"array"},fn:function(e,r){for(var a=t.modes[e],n=Array(r.length),o=0;o<r.length;o++){var i=a[a.keys[o]]||a.alpha;n[o]=h(r[o],i.max,i.min,0)}return n}}},array:{path_exclude:!0,ratio:{from:{mode:"array",type:"array"},to:{mode:"ratio",type:"array"},fn:function(e,r){for(var a=t.modes[e],n=Array(r.length),o=0;o<r.length;o++){var i=a[a.keys[o]]||a.alpha;n[o]=s(r[o],i.max,i.min,0)}return n}}}},t.parsers=[t.converters.hex.rgb.fn,t.converters.css.rgb.fn,t.converters.css.hsl.fn,W],t.adjusters={lightness:{available_modes:{hsl:"l",hsv:"v",lab:"l",luv:"l",lch:"l"},default_mode:"hsl",type:"ratio"},saturation:{available_modes:{hsl:"s",hsv:"s"},default_mode:"hsl",type:"ratio"},chroma:{available_modes:{lch:"c"},default_mode:"lch",type:"value"},hue:{available_modes:{hsl:"h",hsv:"h",lch:"h"},default_mode:"hsl",type:"loop"},adjust_alpha:{available_modes:{grayscale:"alpha",rgb:"alpha",hsv:"alpha",hsl:"alpha",cmyk:"alpha",xyz:"alpha",lab:"alpha",luv:"alpha",lch:"alpha",lms:"alpha",dkl:"alpha"},default_mode:"rgb",type:"ratio"}},t.series={triad:{n:3,supported_modes:{hsl:L,hsv:L,lch:L},default_mode:"hsl"},adjacent:{n:3,supported_modes:{hsl:$,hsv:$,lch:$},default_mode:"hsl"},complement:{n:2,supported_modes:{hsl:S,hsv:S,lch:S},default_mode:"hsl"},shades:{n:4,supported_modes:{hsl:C,hsv:C,lab:C,luv:C,lch:C},default_mode:"hsl"}},t.prototype.gamma=function(t,e){return e=e||2.2,this.to_rgb(0),this.ratio=this.ratio.map(function(r){return Math.pow(r,t/e)}),this},t.prototype.wb=function(e,r){var a=t.modes.rgb,n=e.rgb(),o=this.mode,i=a.r.max,s=a.g.max,h=a.b.max;return this.mode="rgb",this[0]*=0===n[0]?i:i/n[0],this[1]*=0===n[1]?s:s/n[1],this[2]*=0===n[2]?h:h/n[2],this.to(o,r),this},t.prototype.under=function(e){if(e instanceof t){var r=this.rgb(0),a=this.mode,n=r.alphaRatio,o=e.alphaRatio;e=e.rgb();for(var i=0;i<this.length;i++)r[i]=e[i]*o+r[i]*(1-o);return r.alphaRatio=n+o-n*o,r.to(a)}return null},t.prototype.over=function(e){return e instanceof t?e.under(this):null},t.prototype.mask_by=function(e){if(e instanceof t){for(var r=this.rgb(0),a=this.mode,n=e.rgb(0),o=n.alphaRatio,i=r.alphaRatio,s=0;s<this.length;s++)r[s]=Math.min(r[s]*i,e[s]*o)/i;return r.to(a)}return null},t.prototype.expose_by=function(e){if(e instanceof t){var r=this.rgb(0),a=this.mode,n=e.rgb(0),o=n.alphaRatio,i=r.alphaRatio;e=e.rgb();for(var s=0;s<this.length;s++)r[s]=Math.max(r[s]*i,e[s]*o)/i;return r.to(a)}return null},t.prototype.add=function(e){if(e instanceof t){var r=this.rgb(0),a=this.mode,n=r.alphaRatio,o=e.alphaRatio,i=Math.max(n,o);e=e.rgb();for(var s=0;s<this.length;s++)r[s]=(r[s]*n+e[s]*o)/i;return r.alphaRatio=i,r.to(a).truncate()}return null},t.prototype.subtract=function(e){if(e instanceof t){var r=this.rgb(0),a=this.mode,n=r.alphaRatio,o=e.alphaRatio;e=e.rgb();for(var i=0;i<this.length;i++)r[i]-=e[i]*o/n;return r.to(a).truncate()}return null},t.prototype.threshold=function(e,r){if(e instanceof t){for(var a=this.mode,n=e[a](0),o=r instanceof t?r[a](0):new t(a),i=this.alphaRatio,s=n.alphaRatio,h=o.alphaRatio,l=0;l<this.length;l++)this[l]=t.math.number_truncate(this[l]*i,n[l]*s,o[l]*h,0)/i;return this}return null},t.prototype.noise=function(e,r){r=!isFinite(r)||0>r?0:r>1?1:+r;var a=Math.random(),n=t.modes.rgb,o=(""+a).substr(2,3)/999*n.r.max,i=(""+a).substr(5,3)/999*n.g.max,s=(""+a).substr(8,3)/999*n.b.max,h=(1-(""+a).substr(11,3)/999*r)*n.alpha.max,l=t(o,i,s,h);return e&&(l=l.grayscale()),this.under(l)},t.prototype.light_contrast=function(e){e=t.prototype.light_contrast.available_modes.hasOwnProperty(e)?e:t.prototype.light_contrast.available_modes.hasOwnProperty(this.mode)?this.mode:t.prototype.light_contrast.default_mode;var r=t.prototype.light_contrast.available_modes[e],a=t.modes[e],n=a[a.keys[r.l]].max-a[a.keys[r.l]].min,o=this[e](0),i=o[r.l];return o[r.l]=n>i?.5*n>i?i>0?n-i/2-1:n-1:(n-i)/2+1:1,o[r.h]=(o[r.h]+180)%360,o[this.mode]()},t.prototype.light_contrast.available_modes={hsl:{h:0,l:2},hsv:{h:0,l:2},lch:{h:2,l:0}},t.prototype.light_contrast.default_mode="lch",t.prototype.contrast_with=function(e,r){var a=t.prototype.contrast_with.available_modes.hasOwnProperty(r)?r:t.prototype.contrast_with.available_modes.hasOwnProperty(this.mode)?this.mode:t.prototype.contrast_with.default_mode,n=t.prototype.contrast_with.available_modes[a],o=t.modes[a],i=this[a](0),s=e[a](0),h=t.fn.average(i,s),l=o[o.keys[n.c]].range,p=o[o.keys[n.l]].range,u=o.alpha.range,m=(i[n.h]+s[n.h])/2,c=(i[n.c]+s[n.c])/2,y=Math.abs(i[n.c]-s[n.c]),d=(i[n.l]+s[n.l])/2,f=Math.abs(i[n.l]-s[n.l]),g=0,b=(i.alphaRatio+s.alphaRatio)*u/2,x=0===h[n.c]?m:h[n.h],_=l-c/3+y/6,M=0;switch(i[n.l]>4*p/7?g+=3:i[n.l]<3*p/7||(g+=1),s[n.l]>4*p/7?g+=3:s[n.l]<3*p/7||(g+=1),g){case 6:case 4:M=2*(6*d-f)/9-16*p/21,0>M&&(M=0);break;case 3:M=(d+p)/3;break;case 2:M=p/2>p-d+d?3*p/7:3*-p/7;break;case 1:case 0:M=(4*d+f)/3+3*p/7,v>p&&(M=p)}var w=[];w[n.l]=M,w[n.c]=_,w[n.h]=x,w.push(b),w.push(a);var z=new t(w);return 0===c&&0===y||"hsl"===a&&M===t.modes.hsl.l.max||"lch"!==a&&M===t.modes.hsl.l.min?(z[n.c]=0,z):z.hue(180)},t.prototype.contrast_with.available_modes={hsl:{h:0,c:1,l:2},hsv:{h:0,c:1,l:2},lch:{h:2,c:1,l:0}},t.prototype.contrast_with.default_mode="lch",t.prototype.distance=function(e,r){var a=this.mode,n=e[a](0);return t.prototype.distance.fn.hasOwnProperty(a)?t.prototype.distance.fn[a](this,n,r):null},t.prototype.distance.fn={grayscale:function(t,e){return Math.abs(t[0]-e[0])},rgb:function(t,e,r){var a=t.ratio,n=e.ratio;return Math.sqrt((Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2)+Math.pow(a[2]-n[2],2))/(r?1:3))},hsv:function(t,e,r){var a=t.ratio,n=e.ratio;return a[1]>0&&a[2]>0?n[1]>0&&n[2]>0||(n[0]=a[0]):a[0]=n[0],Math.sqrt((Math.pow(Math.cos(2*a[0]*Math.PI)*a[1]-Math.cos(2*n[0]*Math.PI)*n[1],2)+Math.pow(Math.sin(2*a[0]*Math.PI)*a[1]-Math.sin(2*n[0]*Math.PI)*n[1],2)+Math.pow(a[2]-n[2],2))/(r?1:5))},hsl:function(t,e,r){var a=t.ratio,n=e.ratio;return a[1]>0&&a[2]>0&&a[2]<1?n[1]>0&&n[2]>0&&n[2]<1||(n[0]=a[0]):a[0]=n[0],Math.sqrt((Math.pow(Math.cos(2*a[0]*Math.PI)*a[1]-Math.cos(2*n[0]*Math.PI)*n[1],2)+Math.pow(Math.sin(2*a[0]*Math.PI)*a[1]-Math.sin(2*n[0]*Math.PI)*n[1],2)+Math.pow(a[2]-n[2],2))/(r?1:5))},cmyk:function(t,e,r){var a=t.rgb(0).ratio,n=e.rgb(0).ratio;return Math.sqrt((Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2)+Math.pow(a[2]-n[2],2))/(r?1:3))},xyz:function(e,r,a){var n=t.modes.xyz;return Math.sqrt((Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)+Math.pow(e[2]-r[2],2))/(a?1:Math.pow(n.x.max-n.x.min,2)+Math.pow(n.y.max-n.y.min,2)+Math.pow(n.z.max-n.z.min,2))*100)},lab:function(e,r,a){var n=t.modes.lab;return Math.sqrt((Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)+Math.pow(e[2]-r[2],2))/(a?1:Math.pow(n.l.max-n.l.min,2)+Math.pow(n.a.max-n.a.min,2)+Math.pow(n.b.max-n.b.min,2))*100)},luv:function(e,r,a){var n=t.modes.luv;return Math.sqrt((Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)+Math.pow(e[2]-r[2],2))/(a?1:Math.pow(n.l.max-n.l.min,2)+Math.pow(n.u.max-n.u.min,2)+Math.pow(n.v.max-n.v.min,2))*100)},lch:function(t,e,r){var a=t.lab(0),n=e.lab(0),o=e[0]-t[0],i=(t[0]+e[0])/2,s=Math.sqrt(Math.pow(a[1],2)+Math.pow(a[2],2)),h=Math.sqrt(Math.pow(n[1],2)+Math.pow(n[2],2)),l=(s+h)/2,p=Math.sqrt(Math.pow(l,7)/(Math.pow(l,7)+Math.pow(25,7))),u=a[1]+n[1]/2*(1-p),m=n[1]+a[1]/2*(1-p),c=Math.sqrt(Math.pow(u,2)+Math.pow(a[2],2)),y=Math.sqrt(Math.pow(m,2)+Math.pow(n[2],2)),d=y-c,f=Math.atan2(a[2],u)%(2*Math.PI)||0,g=Math.atan2(n[2],m)%(2*Math.PI)||0,v=Math.abs(g-f),b=g-f+(v>Math.PI?g>f?-2*Math.PI:2*Math.PI:0),x=2*Math.sqrt(c*y)*Math.sin(b/2),_=(f+g)/2+(v>Math.PI?Math.PI:0),M=(1-.17*Math.cos(_-Math.PI/6)+.24*Math.cos(2*_)+.32*Math.cos(3*_+Math.PI/30)-.2*Math.cos(4*_-7*Math.PI/20),1+.015*Math.pow(i-50,2)/Math.sqrt(20+Math.pow(i-50,2)),-2*p*Math.sin(Math.PI/3*Math.exp(-Math.pow((_/Math.PI*180-275)/25,2))));return Math.sqrt(Math.pow(o/1/1,2)+Math.pow(d/1/(1+.045*s),2)+Math.pow(x/1/(1+.015*s),2)+M*d*x/1/(1+.045*s)/1/(1+.015*s))/(r?1:100)}},t.prototype.partial_rate=function(e){if(e=e||t.prototype.partial_rate.default_mode,t.prototype.partial_rate.modes.hasOwnProperty(e)){for(var r=this[e](0),a=0,n=[],o=0;o<r.length;o++)a+=r[o];for(var o=0;o<r.length;o++)n.push(a?r[o]/a:0);return n}},t.prototype.partial_rate.default_mode="rgb",t.prototype.partial_rate.modes={rgb:"rgb",xyz:"xyz"},t.fn.average=function(){for(var e=[],r="",a=new t,n=0;n<arguments.length;n++)arguments[n]instanceof t&&(r||(r=arguments[n].mode),e.push(arguments[n][r](1e-12).arrayWithAlpha));return e.length>0?t.fn.average.modes.hasOwnProperty(r)?(a.mode=r,a.arrayWithAlpha=t.fn.average.modes[r](e),a.truncate(1e-12),a):(a.mode=t.fn.average.default_mode,a.arrayWithAlpha=t.fn.average.modes[t.fn.average.default_mode](e),a.truncate(1e-12),a):null},t.fn.average.default_mode="rgb",t.fn.average.default_fn=function(e,r){for(var a=Array(t.modes[e].keys.length),n=[],o=0;o<a.length;o++)a[o]=0;a[o]=0;for(var i=0;i<r.length;i++){for(n=t.converters.array.ratio.fn(e,r[i]),o=0;o<n.length-1;o++)a[o]+=n[o]*n[n.length-1];a[o]+=n[n.length-1]}for(a[n.length-1]/=r.length,o=0;o<n.length-1;o++)a[o]/=r.length*a[n.length-1];return t.converters.ratio.array.fn(e,a)},t.fn.average.modes={rgb:t.fn.average.default_fn.bind(null,"rgb"),hsv:function(e){for(var r="hsv",a=[0,0,0,0],o=[],i=0;i<e.length;i++)o=t.converters.array.ratio.fn(r,e[i]),a[0]+=n(Math.cos(2*o[0]*Math.PI)*o[1]*o[3],-15),a[1]+=n(Math.sin(2*o[0]*Math.PI)*o[1]*o[3],-15),a[2]+=o[2]*o[3],a[3]+=o[3];a[3]/=e.length,a[0]/=e.length*a[3],a[1]/=e.length*a[3],a[2]/=e.length*a[3];var s=(Math.atan2(a[1],a[0])/Math.PI/2+1)%1,h=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));return t.converters.ratio.array.fn(r,[s,h,a[2],a[3]])},hsl:function(e){for(var r="hsl",a=[0,0,0,0],o=[],i=0,s=0;s<e.length;s++)o=t.converters.array.ratio.fn(r,e[s]),0===o[2]||1===o[2]?i++:(a[0]+=n(Math.cos(2*o[0]*Math.PI)*o[1]*o[3],-15),a[1]+=n(Math.sin(2*o[0]*Math.PI)*o[1]*o[3],-15)),a[2]+=o[2]*o[3],a[3]+=o[3];a[3]/=e.length,a[0]/=(e.length-i)*a[3],a[1]/=(e.length-i)*a[3],a[2]/=e.length*a[3];var h=(Math.atan2(a[1],a[0])/Math.PI/2+1)%1,l=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));return t.converters.ratio.array.fn(r,[h,l,a[2],a[3]])},cmyk:t.fn.average.default_fn.bind(null,"cmyk"),xyz:t.fn.average.default_fn.bind(null,"xyz"),lab:t.fn.average.default_fn.bind(null,"lab"),luv:t.fn.average.default_fn.bind(null,"luv"),lch:function(e){for(var r="lch",a=[0,0,0,0],o=[],i=(new t("lch"),0);i<e.length;i++)o=t.converters.array.ratio.fn(r,e[i]),a[0]+=n(Math.cos(2*o[2]*Math.PI)*o[1]*o[3],-15),a[1]+=n(Math.sin(2*o[2]*Math.PI)*o[1]*o[3],-15),a[2]+=o[0]*o[3],a[3]+=o[3];a[3]/=e.length,a[0]/=e.length*a[3],a[1]/=e.length*a[3],a[2]/=e.length*a[3];var s=(Math.atan2(a[1],a[0])/Math.PI/2+1)%1,h=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));return t.converters.ratio.array.fn(r,[a[2],h,s,a[3]])},lms:t.fn.average.default_fn.bind(null,"lms")},t.prototype.log=function(e,r,a){r=t.modes.hasOwnProperty(r)?r:this.mode,e=isFinite(e)?e:!1;var n=this[r](e);a?console.log(n.mode,n," alpha:",n.alphaValue," valid:",n.validate()):n.validate()?console.log("%c         %c ","background-color: "+n.css()+"; border: 1px solid #EEE;","",n.mode,n," alpha:",n.alphaValue):n.in_scale?console.log("%c inRange %c ","background-color: "+n.css()+"; border: 1px solid #EEE; color: rgba( 220, 220, 220, 0.4 );","",n.mode,n," alpha:",n.alphaValue):console.log("%c invalid %c ","background-color: #EEE; border: 1px solid #EEE; color: #222;","",n.mode,n," alpha:",n.alphaValue)},t.fn.css_linear_gradient=N,t.fn.css_radial_gradient=B,t.fn.set_converters_to_prototype=P,P(),t.fn.set_converters_matrix=O,O(),t.fn.set_adjusters_to_prototype=q,q(),t.fn.set_series_to_prototype=D,D(),t.math={last_exp:a,exp_round:n,number_truncate:i,number_to_ratio:s,ratio_to_number:h,ratio_to_number_with_truncate:l,validate:p,quadratic_resolution:o},t.fn.a2a=_,t.fn.array_convert=A,t.fn.parse=I,t.Set=U,t.old_Color=J,t}(Color);